# openCV_canny+HSV+ê°€ìš°ì‹œì•ˆ+ë…¹ìƒ‰ì‹ í˜¸ë“± ì½”ë“œ

## ê¸°ì¡´ ì‹ í˜¸ë“± ì¸ì‹ ì½”ë“œ
> https://colab.research.google.com/drive/1QftS54mhghhs3xLfIMBABcxz6Oq0q5lK#scrollTo=-NfuZzAOnlsv

# ê¸°ì¡´ ì½”ë“œ ë¶„ì„ ê²°ê³¼

### ğŸš¦ ì‹ í˜¸ë“± ì¸ì‹ í”„ë¡œê·¸ë¨ (Python + OpenCV)

> ì´ˆë³´ìë¥¼ ìœ„í•œ ì‹ í˜¸ë“± ì¸ì‹ í”„ë¡œì íŠ¸ ì •ë¦¬  
> - OpenCV, NumPy, Matplotlib, Google Colab í™˜ê²½ ì‚¬ìš©  
> - ìƒ‰ìƒ í•„í„°ë§ + Canny Edge + ìœ¤ê³½ì„  ë¶„ì„ ê¸°ë°˜

---

### ğŸ“Œ ì£¼ìš” ê¸°ëŠ¥ ìš”ì•½

- ë¹¨ê°•/ë…¸ë‘/ì´ˆë¡/íŒŒë‘ ì‹ í˜¸ë“± ìƒ‰ìƒë§Œ í•„í„°ë§
- Canny ì—£ì§€ ê²€ì¶œë¡œ ìœ¤ê³½ì„  ì¶”ì¶œ
- ì›í˜•ì„±, ìœ„ì¹˜, ë©´ì  ê¸°ì¤€ìœ¼ë¡œ ì‹ í˜¸ë“± íŒë‹¨
- ì‚¬ê°í˜•ìœ¼ë¡œ ê²€ì¶œ ê²°ê³¼ ì‹œê°í™”
- íŒŒë¼ë¯¸í„° ì¡°ì • ë° ë¹„êµ ê¸°ëŠ¥ í¬í•¨

---

### âœ… ì½”ë“œ êµ¬ì¡° ë° ì„¤ëª…

#### 1ï¸âƒ£ ë¼ì´ë¸ŒëŸ¬ë¦¬ ë¶ˆëŸ¬ì˜¤ê¸°

```python
import cv2 # ì´ë¯¸ì§€ ì²˜ë¦¬ìš©
import numpy as np # ì´ë¯¸ì§€ ë°°ì—´ ì²˜ë¦¬
import matplotlib.pyplot as plt # ì´ë¯¸ì§€ ì‹œê°í™”
from google.colab import files
from PIL import Image
import io # ì´ë¯¸ì§€ ì—…ë¡œë“œ ë° ì½ê¸°
```

#### 2ï¸âƒ£ ì‹ í˜¸ë“± ê²€ì¶œ í•¨ìˆ˜: `detect_traffic_light_canny()`

ì‚¬ì§„ì—ì„œ ì‹ í˜¸ë“±(ë¹¨ê°•/ë…¸ë‘/ì´ˆë¡/íŒŒë‘)ì„ ì°¾ì•„ë‚´ëŠ” í•µì‹¬ í•¨ìˆ˜ì…ë‹ˆë‹¤.  
HSV ìƒ‰ìƒ í•„í„°ë§ + Canny ì—£ì§€ ê²€ì¶œ + ìœ¤ê³½ì„  ì¡°ê±´ íŒë‹¨ì„ í†µí•´ ì‹ í˜¸ë“±ë§Œ ê³¨ë¼ëƒ…ë‹ˆë‹¤.

---

#### ì²˜ë¦¬ ìˆœì„œ ìš”ì•½

| ë‹¨ê³„ | ì„¤ëª… | í•¨ìˆ˜/ê¸°ëŠ¥ |
|------|------|-----------|
| Step 0 | HSV ìƒ‰ìƒ í•„í„°ë§ (ë¹¨ê°•/ë…¸ë‘/ì´ˆë¡/íŒŒë‘) | `cv2.cvtColor`, `cv2.inRange`, `cv2.bitwise_or` |
| Step 1 | í•„í„°ë§ ê²°ê³¼ë¥¼ í‘ë°±ìœ¼ë¡œ ë³€í™˜ | `cv2.cvtColor(..., COLOR_BGR2GRAY)` |
| Step 2 | GaussianBlurë¡œ ë…¸ì´ì¦ˆ ì œê±° | `cv2.GaussianBlur()` |
| Step 3 | Canny ì—£ì§€ ê²€ì¶œ (ê²½ê³„ì„  ê°•ì¡°) | `cv2.Canny()` |
| Step 4 | ìœ¤ê³½ì„ (contour) ì°¾ê¸° | `cv2.findContours()` |
| Step 5 | ìœ¤ê³½ì„  í•„í„°ë§ (ë©´ì , ìœ„ì¹˜, ë¹„ìœ¨, ì›í˜•ì„±) | `cv2.contourArea()`, `cv2.boundingRect()` ë“± |

---

##### ğŸ¯ Step 5 â€“ ì¡°ê±´ í•„í„°ë§ ê¸°ì¤€

| ì¡°ê±´ëª… | ê¸°ì¤€ | ì„¤ëª… |
|--------|------|------|
| ë©´ì  (`area`) | `min_area` ~ `max_area` | ë„ˆë¬´ ì‘ê±°ë‚˜ ë„ˆë¬´ í° ê°ì²´ëŠ” ì œì™¸ |
| ìœ„ì¹˜ (`y`) | ìƒë‹¨ 70% ì´ë‚´ë§Œ í—ˆìš© | í•˜ë‹¨ 30%ì— ìˆëŠ” ê°ì²´ëŠ” ì œì™¸ (ì‹ í˜¸ë“±ì€ ë³´í†µ ìœ„ì— ìˆìŒ) |
| ì¢…íš¡ë¹„ (`aspect_ratio = w/h`) | â‰¤ 0.8 | ì‹ í˜¸ë“±ì€ ë³´í†µ ì„¸ë¡œë¡œ ê¹€ |
| ì›í˜•ì„± (`circularity`) | â‰¥ 0.25 (ê¸°ë³¸ê°’) | `4Ï€ Ã— ë©´ì  / ë‘˜ë ˆÂ²` ê°’. ì›í˜•ì— ê°€ê¹Œìš¸ìˆ˜ë¡ 1ì— ê°€ê¹Œì›€ |

---

#### âœ… ë°˜í™˜ê°’

- `traffic_lights`: ì‹ í˜¸ë“±ìœ¼ë¡œ íŒë‹¨ëœ `(x, y, w, h)` ì¢Œí‘œ ë¦¬ìŠ¤íŠ¸
- `edges`: ì¤‘ê°„ì— ê³„ì‚°ëœ Canny ì—£ì§€ ì´ë¯¸ì§€

```python
return traffic_lights, edges
```

#### 3ï¸âƒ£ ê²°ê³¼ ì‹œê°í™” í•¨ìˆ˜: `draw_detections()`

ì‹ í˜¸ë“±ìœ¼ë¡œ ê²€ì¶œëœ ê°ì²´ë“¤ì— ëŒ€í•´ ì´ë¯¸ì§€ ìœ„ì— **ì‚¬ê°í˜•ê³¼ ë¼ë²¨ í…ìŠ¤íŠ¸ë¥¼ ê·¸ë¦¬ëŠ” í•¨ìˆ˜**ì…ë‹ˆë‹¤.  
ìµœì¢… ê²°ê³¼ ì´ë¯¸ì§€ë¥¼ ì‚¬ìš©ìì—ê²Œ ì‹œê°ì ìœ¼ë¡œ ë³´ì—¬ì¤„ ìˆ˜ ìˆê²Œ ë§Œë“­ë‹ˆë‹¤.

---

#### ğŸ§  í•¨ìˆ˜ ì •ì˜

```python
def draw_detections(image, detections):
    result = image.copy()
    for i, (x, y, w, h) in enumerate(detections):
        cv2.rectangle(result, (x, y), (x + w, y + h), (0, 255, 0), 2) # ì‚¬ê°í˜• ìƒ‰ìƒ - ì´ˆë¡ìƒ‰
        cv2.putText(result, f'Traffic Light {i+1}', (x, y-10), # í…ìŠ¤íŠ¸ ìœ„ì¹˜ - ë°•ìŠ¤ ìœ„ìª½ ì—¬ë°±
                    cv2.FONT_HERSHEY_SIMPLEX, 0.5, (0, 255, 0), 1) # í°íŠ¸, í…ìŠ¤íŠ¸ í¬ê¸°
    return result
```
#### 4ï¸âƒ£ ìƒ‰ìƒ í•„í„°ë§ ë¹„êµ í•¨ìˆ˜: `compare_with_without_color()`

> ìƒ‰ìƒ í•„í„°ë§ì„ **ì‚¬ìš©í•œ ê²½ìš°ì™€ ì‚¬ìš©í•˜ì§€ ì•Šì€ ê²½ìš°**ì˜ ì‹ í˜¸ë“± ì¸ì‹ ì„±ëŠ¥ì„ ë¹„êµí•˜ëŠ” í•¨ìˆ˜ì…ë‹ˆë‹¤.

---

##### ğŸ“‹ ì£¼ìš” ëª©ì 

| í•­ëª© | ì„¤ëª… |
|------|------|
| í…ŒìŠ¤íŠ¸ | ê°™ì€ ì´ë¯¸ì§€ë¡œ ë‘ ë°©ì‹(Cannyë§Œ vs ìƒ‰ìƒ í•„í„°ë§+Canny)ì„ ë¹„êµ |
| ì‹œê°í™” | ë‘ ê²°ê³¼ë¥¼ í•œ í™”ë©´ì— ë‚˜ë€íˆ ì‹œê°í™” |
| í‰ê°€ | ì–´ë–¤ ë°©ë²•ì´ ë” ì •í™•í•˜ê²Œ ê²€ì¶œí•˜ëŠ”ì§€ íŒë‹¨ |

---

##### ì²˜ë¦¬ ìˆœì„œ ìš”ì•½

1. Google Colabì—ì„œ ì´ë¯¸ì§€ ì—…ë¡œë“œ
2. ìƒ‰ìƒ í•„í„°ë§ **ì‚¬ìš©í•˜ì§€ ì•ŠìŒ** â†’ `detect_traffic_light_canny(..., use_color_filter=False)`
3. ìƒ‰ìƒ í•„í„°ë§ **ì‚¬ìš©í•¨** â†’ `detect_traffic_light_canny(..., use_color_filter=True)`
4. `draw_detections()`ë¡œ ê²°ê³¼ ì´ë¯¸ì§€ ìƒì„±
5. `matplotlib`ìœ¼ë¡œ ë‘ ê²°ê³¼ ë‚˜ë€íˆ ë¹„êµ

---


#### 5ï¸âƒ£ íŒŒë¼ë¯¸í„° ë¹„êµ í•¨ìˆ˜ : `adjust_parameters_and_test()`

##### âš™ï¸ íŒŒë¼ë¯¸í„° ë¹„êµ ì„¤ì •í‘œ (adjust_parameters_and_test)

ë‹¤ì–‘í•œ ì¡°ê±´ì—ì„œ ì‹ í˜¸ë“± ì¸ì‹ ì„±ëŠ¥ì„ í…ŒìŠ¤íŠ¸í•  ìˆ˜ ìˆë„ë¡  
ê° íŒŒë¼ë¯¸í„° ì„¸íŠ¸ë¥¼ ë¯¸ë¦¬ ì •ì˜í•´ ë‘ì—ˆìŠµë‹ˆë‹¤.

| í…ŒìŠ¤íŠ¸ ì´ë¦„ | `min_area` | `max_area` | `canny_low` | `canny_high` | `circularity_threshold` | íŠ¹ì§• |
|-------------|------------|------------|-------------|--------------|--------------------------|------|
| ê¸°ë³¸ê°’       | 100        | 5000       | 50          | 150          | 0.30                     | í‰ê· ì ì¸ ì¡°ê±´ |
| ë” ë¯¼ê°í•˜ê²Œ   | 50         | 10000      | 30          | 120          | 0.20                     | ë” ì‘ì€ ê°ì²´ë„ íƒì§€ |
| ë” ì—„ê²©í•˜ê²Œ   | 200        | 8000       | 70          | 200          | 0.40                     | ì •í™•ë„ ìš°ì„ , ì‘ì€ ë¬¼ì²´ ë°°ì œ |
| í° ì‹ í˜¸ë“±ìš©   | 500        | 15000      | 40          | 160          | 0.25                     | ëŒ€í˜• ì‹ í˜¸ë“±ì— ì í•© |


#### 6ï¸âƒ£ ë‹¨ì¼ ì´ë¯¸ì§€ ì—…ë¡œë“œ í•¨ìˆ˜: `upload_and_detect()`

> ì´ í•¨ìˆ˜ëŠ” ì‚¬ìš©ìê°€ ë‹¨ì¼ ì´ë¯¸ì§€ë¥¼ ì—…ë¡œë“œí•˜ë©´ **ìµœì í™”ëœ íŒŒë¼ë¯¸í„°**ë¡œ ì‹ í˜¸ë“±ì„ ìë™ ê²€ì¶œí•˜ê³ ,  
> ê·¸ ê²°ê³¼ë¥¼ ì‹œê°ì ìœ¼ë¡œ ë³´ì—¬ì£¼ëŠ” ë©”ì¸ ì‹¤í–‰ í•¨ìˆ˜ì…ë‹ˆë‹¤.

---

##### ğŸ§  ì£¼ìš” ê¸°ëŠ¥ ìš”ì•½

| ê¸°ëŠ¥ | ì„¤ëª… |
|------|------|
| ì´ë¯¸ì§€ ì—…ë¡œë“œ | Google Colabì˜ `files.upload()` ì´ìš© |
| í¬ê¸° ì¡°ì • | ë„ˆë¹„ê°€ 1200px ì´ìƒì¼ ê²½ìš° ë¦¬ì‚¬ì´ì§• |
| ì‹ í˜¸ë“± ê²€ì¶œ | `detect_traffic_light_canny()` í•¨ìˆ˜ í˜¸ì¶œ |
| ì‹œê°í™” ì¶œë ¥ | `draw_detections()`ë¡œ ê²°ê³¼ ì´ë¯¸ì§€ ìƒì„± í›„ `matplotlib` ì‹œê°í™” |
| ì •ë³´ ì¶œë ¥ | ì‹ í˜¸ë“± ê°œìˆ˜, ìœ„ì¹˜, í¬ê¸° ì¶œë ¥ |

---

##### âš™ï¸ ì‚¬ìš© íŒŒë¼ë¯¸í„° (ìµœì í™”ëœ ê°’), ê²©ìì˜ ìˆ«ìê°€ ì˜ë¯¸í•˜ëŠ” ë°”?

| íŒŒë¼ë¯¸í„° | ê°’ | ì„¤ëª… |
|----------|-----|------|
| `min_area` | 100 | ë„ˆë¬´ ì‘ì€ ê°ì²´ ì œì™¸ |
| `max_area` | 8000 | ë„ˆë¬´ í° ê°ì²´ ì œì™¸ |
| `canny_low` | 30 | Canny ê²½ê³„ í•˜í•œê°’ |
| `canny_high` | 120 | Canny ê²½ê³„ ìƒí•œê°’ |
| `circularity_threshold` | 0.25 | ì›í˜•ì„± ê¸°ì¤€ |
| `use_color_filter` | `True` | ìƒ‰ìƒ í•„í„°ë§ í™œì„±í™” (ë¹¨ê°•, ë…¸ë‘, ì´ˆë¡, íŒŒë‘) |

-----------------------

# ê²€ì¶œëœ ì‹ í˜¸ë“±ì— ì´ˆë¡ìƒ‰ ë°•ìŠ¤ ê·¸ë¦¬ê¸° + 10ë“±ë¶„ ê²©ìì„  ì¶”ê°€í•˜ëŠ” ì½”ë“œ

## `draw_detections()` í•¨ìˆ˜

> ì‹ í˜¸ë“± ê²€ì¶œ ê²°ê³¼ë¥¼ ì‹œê°ì ìœ¼ë¡œ í‘œí˜„í•˜ê³ , ì„ íƒì ìœ¼ë¡œ **10x10 ê²©ì**ì™€ **ê²©ì ë²ˆí˜¸**ê¹Œì§€ ê·¸ë ¤ì£¼ëŠ” í•¨ìˆ˜ ê¸°ì¡´ ì½”ë“œ ì•„ë˜ ë¶€ë¶„ì— ì¶”ê°€í•˜ê¸°

---

### ğŸ”§ í•¨ìˆ˜ ì •ì˜

```python
def draw_detections(image, detections, draw_grid=True):
    result = image.copy()
    
    # ê²©ìì„  ê·¸ë¦¬ê¸°
    if draw_grid:
        height, width = image.shape[:2]
        
       
        
        # ê°€ë¡œì„  (10ë“±ë¶„)
        for i in range(1, 10):
            y = int(height * i / 10)
            cv2.line(result, (0, y), (width, y), (255, 255, 255), 1)  # í°ìƒ‰ ê°€ë¡œì„ 
        
        # ê²©ì ë²ˆí˜¸ ì¶”ê°€ (êµ¬ì—­ í‘œì‹œ)
        for i in range(10):
            for j in range(10):
                x_center = int(width * (j + 0.5) / 10)
                y_center = int(height * (i + 0.5) / 10)
                grid_number = i * 10 + j + 1
                cv2.putText(result, str(grid_number), (x_center - 10, y_center + 5),
                           cv2.FONT_HERSHEY_SIMPLEX, 0.4, (255, 255, 255), 1)
    
    # ì‹ í˜¸ë“± ê²€ì¶œ ë°•ìŠ¤ ê·¸ë¦¬ê¸°
    for i, (x, y, w, h) in enumerate(detections):
        cv2.rectangle(result, (x, y), (x + w, y + h), (0, 255, 0), 2)
        cv2.putText(result, f'Traffic Light {i+1}', (x, y-10),
                    cv2.FONT_HERSHEY_SIMPLEX, 0.5, (0, 255, 0), 1)
        
        # ê° ì‹ í˜¸ë“±ì´ ì–´ëŠ ê²©ìì— ìœ„ì¹˜í•˜ëŠ”ì§€ í‘œì‹œ
        center_x = x + w // 2
        center_y = y + h // 2
        height, width = image.shape[:2]
        
        grid_col = int(center_x * 10 / width)
        grid_row = int(center_y * 10 / height)
        grid_number = grid_row * 10 + grid_col + 1
        
        cv2.putText(result, f'Grid: {grid_number}', (x, y + h + 20),
                   cv2.FONT_HERSHEY_SIMPLEX, 0.4, (0, 255, 0), 1)
    
    return result
```













